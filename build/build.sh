#!/usr/bin/env bash
# DO NOT EDIT THIS FILE AS IT IS AUTOGENERATED!


# default values of variables set from params
YARN_SETUP=false
VERSIONS=false
YARN_INSTALL=false
BROWSERSLIST=false
UPDATE_EMOJIS=false
JSON_YAML_FORMAT=false
ESLINT=false
TSC=false
USERSCRIPT=false
BUILDSCRIPT=false
PREBUILD=false
WEBPACK=false
DOCS=false
GIT_DIFF=false
ZIP=false
MODE="development"

while :; do
    case "${1-}" in
        --yarn_setup) YARN_SETUP=true ;;
        --versions) VERSIONS=true ;;
        --yarn_install) YARN_INSTALL=true ;;
        --browserslist) BROWSERSLIST=true ;;
        --update_emojis) UPDATE_EMOJIS=true ;;
        --json_yaml_format) JSON_YAML_FORMAT=true ;;
        --eslint) ESLINT=true ;;
        --tsc) TSC=true ;;
        --userscript) USERSCRIPT=true ;;
        --buildscript) BUILDSCRIPT=true ;;
        --prebuild) PREBUILD=true ;;
        --webpack) WEBPACK=true ;;
        --docs) DOCS=true ;;
        --git_diff) GIT_DIFF=true ;;
        --zip) ZIP=true ;;
        --dependencies)
          YARN_SETUP=true
          VERSIONS=true
          YARN_INSTALL=true
          BROWSERSLIST=true ;;
        --quick)
          JSON_YAML_FORMAT=true
          ESLINT=true
          TSC=true
          WEBPACK=true ;;
        --full)
          YARN_SETUP=true
          VERSIONS=true
          YARN_INSTALL=true
          BROWSERSLIST=true
          UPDATE_EMOJIS=true
          JSON_YAML_FORMAT=true
          ESLINT=true
          TSC=true
          USERSCRIPT=true
          BUILDSCRIPT=true
          PREBUILD=true
          WEBPACK=true
          DOCS=true
          GIT_DIFF=true
          ZIP=true ;;
        -p | --production) MODE="production" ;;
        -?*)
          echo "Unknown option: $1"
          exit 1 ;;
        *) break ;;
    esac
    shift
done

total_start_time=$(date +%s%N)

# [â¬†] set yarn to stable
if [[ $YARN_SETUP = true ]]; then
    start_time=$(date +%s%N)
    echo "### [â¬†] set yarn to stable ###"
    corepack enable
    yarn set version stable
    end_time=$(date +%s%N)
    echo "=== [â¬†] set yarn to stable: $(((end_time - start_time) / 1000000))ms ==="
fi

# [â„¹] print versions (node, yarn, git)
if [[ $VERSIONS = true ]]; then
    start_time=$(date +%s%N)
    echo "### [â„¹] print versions (node, yarn, git) ###"
    echo "node: $(node -v) â€“ yarn: $(yarn -v) â€“ git: $(git --version)"
    end_time=$(date +%s%N)
    echo "=== [â„¹] print versions (node, yarn, git): $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸ±] yarn install
if [[ $YARN_INSTALL = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸ±] yarn install ###"
    yarn install --immutable
    end_time=$(date +%s%N)
    echo "=== [ğŸ±] yarn install: $(((end_time - start_time) / 1000000))ms ==="
fi

# [â¬†] update browserslist
if [[ $BROWSERSLIST = true ]]; then
    start_time=$(date +%s%N)
    echo "### [â¬†] update browserslist ###"
    npx -y browserslist@latest --update-db
    end_time=$(date +%s%N)
    echo "=== [â¬†] update browserslist: $(((end_time - start_time) / 1000000))ms ==="
fi

# [â¬†] update emojis
if [[ $UPDATE_EMOJIS = true ]]; then
    start_time=$(date +%s%N)
    echo "### [â¬†] update emojis ###"
    ./node_modules/.bin/ts-node scripts/utils/fetchEmojis.ts
    end_time=$(date +%s%N)
    echo "=== [â¬†] update emojis: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸš¨] format JSON & YAML files
if [[ $JSON_YAML_FORMAT = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸš¨] format JSON & YAML files ###"
    ./node_modules/.bin/ts-node scripts/format.ts || exit 1
    end_time=$(date +%s%N)
    echo "=== [ğŸš¨] format JSON & YAML files: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸš¨] run ESLint
if [[ $ESLINT = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸš¨] run ESLint ###"
    yarn eslint \
    ./docs/.vuepress/ \
    ./static/         \
    ./prebuild/       \
    ./build/          \
    ./src/            \
    ./scripts/        \
    ./typings/        \
    --ext .js,.ts,.vue,.md \
    -f table \
    --no-error-on-unmatched-pattern \
    --exit-on-fatal-error \
    --report-unused-disable-directives \
    --cache --cache-strategy content \
    --fix \
    || exit 1
    end_time=$(date +%s%N)
    echo "=== [ğŸš¨] run ESLint: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸš¨] check TypeScript
if [[ $TSC = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸš¨] check TypeScript ###"
    yarn tsc -b --pretty "./" || exit 1
    end_time=$(date +%s%N)
    echo "=== [ğŸš¨] check TypeScript: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸ“œ] build userscript
if [[ $USERSCRIPT = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸ“œ] build userscript ###"
    yarn tsc --pretty "src/userscript.ts" || exit 1
    end_time=$(date +%s%N)
    echo "=== [ğŸ“œ] build userscript: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸ“œ] build buildscript
if [[ $BUILDSCRIPT = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸ“œ] build buildscript ###"
    ./node_modules/.bin/ts-node scripts/createBuildScript.ts || exit 1
    end_time=$(date +%s%N)
    echo "=== [ğŸ“œ] build buildscript: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸš§] run prebuild
if [[ $PREBUILD = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸš§] run prebuild ###"
    ./node_modules/.bin/ts-node prebuild/index.ts || exit 1
    end_time=$(date +%s%N)
    echo "=== [ğŸš§] run prebuild: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸ‘·] webpack
if [[ $WEBPACK = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸ‘·] webpack ###"
    ./node_modules/.bin/ts-node build/index.ts --esModuleInterop "$MODE" || exit 1
    end_time=$(date +%s%N)
    echo "=== [ğŸ‘·] webpack: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸ“] build docs
if [[ $DOCS = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸ“] build docs ###"
    ./docs/.vuepress/node_modules/.bin/vuepress build docs || exit 1
    mkdir -p ./dist/docs
    rm -rdf ./dist/docs/*
    cp -r ./docs/.vuepress/dist/* ./dist/docs
    end_time=$(date +%s%N)
    echo "=== [ğŸ“] build docs: $(((end_time - start_time) / 1000000))ms ==="
fi

# [â„¹ï¸] git diff
if [[ $GIT_DIFF = true ]]; then
    start_time=$(date +%s%N)
    echo "### [â„¹ï¸] git diff ###"
    git --no-pager diff --color-words
    end_time=$(date +%s%N)
    echo "=== [â„¹ï¸] git diff: $(((end_time - start_time) / 1000000))ms ==="
fi

# [ğŸ“¦] zip files
if [[ $ZIP = true ]]; then
    start_time=$(date +%s%N)
    echo "### [ğŸ“¦] zip files ###"
    sudo apt-get install zip
    zip -r dist.zip dist
    end_time=$(date +%s%N)
    echo "=== [ğŸ“¦] zip files: $(((end_time - start_time) / 1000000))ms ==="
fi

total_end_time=$(date +%s%N)

echo "=== Total: $(((total_end_time - total_start_time) / 1000000))ms ==="